# NotebookLM Auto-Sync Tool (GAS)

Googleドライブ上の指定フォルダにアップロードされたPDFやMarkdownファイルを、Google NotebookLMで読み込みやすい形式（Googleドキュメント）に自動変換し、同期を維持するためのGoogle Apps Script（GAS）ツールです。

## 💡 背景と目的
NotebookLMは非常に強力なAIアシスタントですが、「ローカルファイルやGoogleドライブのファイルを自動で監視・同期する」という機能が標準では備わっていません。
本ツールは、スタッフが「特定のフォルダにファイルを放り込むだけ」で、裏側で自動的にファイルを整形・管理し、NotebookLMとの連携をシームレスに行うためのブリッジとして機能します。

## ✨ 主な機能

1. **自動変換・OCR処理**
   * Markdownファイル(`.md`)やPDFファイル(`.pdf`)を検知し、自動でGoogleドキュメント形式に変換します。PDFはGoogle Drive APIのOCR機能を用いてテキスト化されます。
2. **スマート更新（ID維持の移植手術）**
   * 同名のファイルが更新された場合、ファイルを削除して作り直すのではなく「中身だけを最新版に書き換える」処理を行います。これにより、NotebookLM側のソース参照IDが維持され、NotebookLM上の「同期」ボタンが正常に機能します。
3. **トレーサビリティの確保（ファイル名へのID付与）**
   * 変換後のファイル名の末尾に、元ファイルのID先頭8文字を自動付与します。（例: `要件定義書_1A2B3C4D`）これにより、同名ファイルの衝突を防ぎ、原本の特定を容易にします。
4. **同期ログの自動生成**
   * 処理完了後、`NotebookLM`フォルダ内に「同期ログ」というドキュメントを自動作成・更新します。どのファイルがいつ同期されたかが一目で確認できます。
5. **自動片付け（無限ループ防止）**
   * 処理が完了した元のPDF/Markdownファイルは、自動的に `Processed` フォルダへ退避されます。

## 📂 フォルダ構成

本スクリプトを稼働させると、監視対象（親フォルダ）の中に自動的に以下のサブフォルダが生成されます。

```text
📁 監視対象フォルダ (SOURCE_FOLDER_ID で指定)
 ├── 📄 仕様書.pdf (スタッフがここにアップロードする)
 ├── 📄 議事録.md
 │
 ├── 📁 NotebookLM (自動生成: NotebookLMに読み込ませる出力先)
 │    ├── 📄 同期ログ (自動生成される管理用ドキュメント)
 │    ├── 📄 仕様書_1A2B3C4D (Googleドキュメント形式)
 │    └── 📄 議事録_5E6F7G8H (Googleドキュメント形式)
 │
 └── 📁 Processed (自動生成: 処理済みの原本を退避)
      ├── 📄 仕様書.pdf (移動済み)
      └── 📄 議事録.md (移動済み)
```

## 🚀 導入手順

### 1. 監視フォルダの準備
1. Googleドライブ上で監視の起点となるフォルダを作成します。
2. フォルダのURLからIDを取得します。
   * 例: `https://drive.google.com/drive/folders/【ここの英数字がID】`

### 2. GASプロジェクトの設定
1. Googleドライブの「新規」>「その他」>「Google Apps Script」を開きます。
2. 左側メニューの「サービス（歯車アイコンの下の＋）」をクリックします。
3. **「Drive API」** を選択して追加します。（※これがないとPDF変換がエラーになります）
4. `Code.gs` に本ツールのスクリプトを貼り付けます。

### 3. スクリプトの初期設定
スクリプト上部の設定項目を、環境に合わせて書き換えてください。

```javascript
// 【必須】監視対象フォルダのID
const SOURCE_FOLDER_ID = 'ここにフォルダIDを貼り付けます';

// 【任意】出力フォルダ名、退避フォルダ名、ログファイル名
const OUTPUT_FOLDER_NAME = 'NotebookLM';
const PROCESSED_FOLDER_NAME = 'Processed'; 
const LOG_FILE_NAME = '同期ログ';
```

> **拠点間のタイムゾーン設定について**
> `updateSyncLog` 関数内にタイムゾーンの指定箇所があります。運用拠点の標準時に合わせて変更してください。
> * 日本時間でログを出力する場合: `'Asia/Tokyo'`
> * ベトナム時間でログを出力する場合: `'Asia/Ho_Chi_Minh'`

### 4. トリガー（定期実行）の設定
1. GASエディタ左側の時計アイコン（トリガー）を開きます。
2. 「トリガーを追加」をクリックし、以下のように設定します。
   * 実行する関数: `autoSyncToNotebookLM`
   * イベントのソース: `時間主導型`
   * 時間ベースのトリガーのタイプ: `分ベースのタイマー`
   * 時間の間隔: `1分おき` または `5分おき`
3. 保存時にGoogleアカウントのアクセス承認を求められたら、「詳細を表示」から許可を進めてください。

## 👷 運用ルール（スタッフ向け）

* **ファイルの追加**: 新しい資料をAIに読み込ませたい場合は、監視対象フォルダ（親フォルダ）にそのまま `.pdf` や `.md` をドロップしてください。数分後に自動処理されます。
* **ファイルの更新**: 既存の資料を更新したい場合は、**「同じファイル名」**で親フォルダに再度ドロップしてください。システムが自動で検知し、NotebookLM側のデータを上書き更新します。
* **確認方法**: `NotebookLM` フォルダ内の「同期ログ」ドキュメントを開くと、最新の取り込み状況を確認できます。

## ⚠️ 注意事項・制限
* **OCRの精度**: PDFのテキスト化はGoogle Driveの標準OCRに依存します。画像化されたテキストの解像度が低い場合、AIが正確に読み取れないことがあります。
* **手動実行**: 即座に反映させたい場合は、GASのエディタ画面から `autoSyncToNotebookLM` を手動で「実行」することも可能です。
