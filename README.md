# NotebookLM Auto-Sync Tool (GAS)

Googleドライブ上の指定フォルダにアップロードされたPDFやMarkdownファイルを、Google NotebookLMで読み込みやすい形式（Googleドキュメント）に自動変換し、同期を維持するためのGoogle Apps Script（GAS）ツールです。

## 💡 背景と目的
NotebookLMは非常に強力なAIアシスタントですが、「ローカルファイルやGoogleドライブのファイルを自動で監視・同期する」という機能が標準では備わっていません。
本ツールは、スタッフが「特定のフォルダにファイルを放り込むだけ」で、裏側で自動的にファイルを整形・管理し、NotebookLMとの連携をシームレスに行うためのブリッジとして機能します。

## ✨ 主な機能

1. **自動変換・OCR処理**
   * Markdownファイル(`.md`)やPDFファイル(`.pdf`)を検知し、自動でGoogleドキュメント形式に変換します。PDFはGoogle Drive APIのOCR機能を用いてテキスト化されます。
2. **スマート更新（ID維持の移植手術）**
   * 同名のファイルが更新された場合、ファイルを削除して作り直すのではなく「中身だけを最新版に書き換える」処理を行います。これにより、NotebookLM側のソース参照IDが維持され、NotebookLM上の「同期」ボタンが正常に機能します。
3. **トレーサビリティの確保（ファイル名へのID付与）**
   * 変換後のファイル名の末尾に、元ファイルのID先頭8文字を自動付与します。（例: `要件定義書_1A2B3C4D`）これにより、同名ファイルの衝突を防ぎ、原本の特定を容易にします。
4. **同期ログの自動生成**
   * 処理完了後、`NoteBookLM`フォルダ内に「同期ログ」というドキュメントを自動作成・更新します。どのファイルがいつ同期されたかが一目で確認できます。
5. **重複処理の防止**
   * 処理済みファイルのIDをスクリプト内部に記録し、同じファイルを二重に変換しません。元ファイルは元の場所にそのまま残ります。

## 📂 フォルダ構成

本スクリプトを稼働させると、監視対象（親フォルダ）の中に自動的に以下のサブフォルダが生成されます。

```text
📁 監視対象フォルダ (SOURCE_FOLDER_ID で指定 / 例: OnlineDr.)
 ├── 📄 仕様書.pdf  ← そのまま残る
 ├── 📄 議事録.md   ← そのまま残る
 │
 └── 📁 NoteBookLM (自動生成: NotebookLMに読み込ませる出力先)
      ├── 📄 同期ログ          (自動生成される管理用ドキュメント)
      ├── 📄 仕様書_1A2B3C4D   (Googleドキュメント形式 .gdoc)
      └── 📄 議事録_5E6F7G8H   (Googleドキュメント形式 .gdoc)
```

> **ポイント**: 元の `.md` / `.pdf` ファイルは移動・削除されません。変換された `.gdoc` だけが `NoteBookLM` フォルダに作成されます。

## 🚀 利用開始ガイド（詳細版）

---

### Step 1. 監視フォルダの作成とIDの取得

1. ブラウザで **Googleドライブ** を開きます。
   * URL: **https://drive.google.com/**
2. 画面左上の **「+ 新規」** ボタンをクリックします。
3. メニューから **「新しいフォルダ」** をクリックします。
4. フォルダ名を入力します（例: `AI同期フォルダ`）。**「作成」** ボタンをクリックします。
5. 作成したフォルダをダブルクリックして開きます。
6. **ブラウザのアドレスバー**に表示されるURLからフォルダIDをコピーします。

```
https://drive.google.com/drive/folders/1aBcDeFgHiJkLmNoPqRsTuVwXyZ
                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                       ↑ この部分がフォルダID（後で使います）
```

> **メモ**: このIDを控えておいてください。Step 3 で使用します。

---

### Step 2. Google Apps Script プロジェクトの作成

1. 同じブラウザで、**Google Apps Script** のホーム画面を開きます。
   * URL: **https://script.google.com/**
2. 画面左上の **「+ 新しいプロジェクト」** ボタンをクリックします。
3. GASエディタが開きます。画面上部に **「無題のプロジェクト」** と表示されているので、クリックして名前を変更します。
   * 推奨名: `NotebookLM Auto-Sync`
   * 入力後、**「名前を変更」** ボタンをクリックします。
4. エディタ中央に `function myFunction() { }` と書かれた `コード.gs` が表示されています。
   * この **既存のコードを全選択（`Ctrl + A`）して削除** します。
5. 本リポジトリの **`Code.gs`** の内容を **すべてコピーして貼り付け** ます。
6. **`Ctrl + S`**（または画面上部のフロッピーディスクアイコン 💾）をクリックして保存します。

---

### Step 3. スクリプトの初期設定（フォルダIDの貼り付け）

貼り付けたスクリプトの **11行目** を見つけてください。

```javascript
const SOURCE_FOLDER_ID = 'ここにフォルダIDを貼り付けます';
```

`'ここにフォルダIDを貼り付けます'` の部分を、**Step 1 で控えたフォルダID** に書き換えます。

```javascript
// 例: 以下のように書き換え
const SOURCE_FOLDER_ID = '1aBcDeFgHiJkLmNoPqRsTuVwXyZ';
```

その他の設定項目（出力フォルダ名・ログファイル名）は、必要に応じて変更してください。通常はそのままで問題ありません。

```javascript
// 【任意】出力フォルダ名、ログファイル名
const OUTPUT_FOLDER_NAME = 'NoteBookLM';
const LOG_FILE_NAME = '同期ログ';
```

> **拠点間のタイムゾーン設定について**
> `updateSyncLog` 関数内にタイムゾーンの指定箇所があります。運用拠点の標準時に合わせて変更してください。
> * 日本時間でログを出力する場合: `'Asia/Tokyo'`
> * ベトナム時間でログを出力する場合: `'Asia/Ho_Chi_Minh'`

変更後、**`Ctrl + S`** で保存します。

---

### Step 4. Drive API サービスの追加

PDF のOCR変換には **Drive API（Advanced Service）** が必要です。これを有効にしないと PDF 処理時にエラーが発生します。

1. GASエディタの **左側サイドバー** を確認します。
2. **「サービス」** の横にある **「+」** アイコンをクリックします。
   * 場所: 左サイドバーの「ライブラリ」の下、「サービス」セクションの右側にある「＋」
3. **「サービスを追加」** ダイアログが表示されます。
4. 一覧から **「Drive API」**（`Google Drive API`）を探してクリックします。
   * バージョン: **v2**（デフォルト）
   * 識別子: **Drive**（デフォルト）
5. 右下の **「追加」** ボタンをクリックします。
6. 左サイドバーの「サービス」の下に **「Drive」** が追加されていれば成功です。

---

### Step 5. 動作テスト（手動実行）

トリガーを設定する前に、まず手動で1回実行して動作を確認します。

1. 事前準備として、**Step 1 で作成したGoogleドライブのフォルダ**に、テスト用のPDFまたは `.md` ファイルを1つアップロードしておきます。
2. GASエディタに戻ります。
3. 画面上部のツールバーにあるドロップダウンで、関数名が **`autoSyncToNotebookLM`** になっていることを確認します。
   * なっていない場合は、ドロップダウンをクリックして **`autoSyncToNotebookLM`** を選択します。
4. ドロップダウンの左にある **「▶ 実行」** ボタンをクリックします。

#### 初回実行時の承認フロー

初めて実行する場合、Googleアカウントのアクセス承認が必要です。以下の手順で進めてください。

1. **「承認が必要です」** というダイアログが表示されます。**「権限を確認」** をクリックします。
2. **Googleアカウントの選択** 画面が表示されます。使用するアカウントをクリックします。
3. **「このアプリは確認されていません」** という警告画面が表示されます。
   * 画面左下の **「詳細」**（または **「Advanced」**）をクリックします。
   * 展開されたテキストの末尾にある **「〈プロジェクト名〉（安全ではないページ）に移動」** をクリックします。
4. **権限の許可画面** が表示されます。以下の権限を確認してください。
   * `Googleドライブのすべてのファイルの参照、編集、作成、削除`
   * `Googleドキュメントのすべてのドキュメントの参照、編集、作成、削除`
5. 画面下部の **「許可」** ボタンをクリックします。

#### 実行結果の確認

1. エディタ下部の **「実行ログ」** パネルに処理結果が表示されます。
   * `実行完了` と表示されれば成功です。
2. **Googleドライブ** の監視フォルダを開いて、以下を確認します。
   * `NoteBookLM` フォルダ内にGoogleドキュメント形式に変換されたファイルがある
   * `同期ログ` ドキュメントが作成されている
   * 元の `.md` / `.pdf` ファイルは元の場所にそのまま残っている

---

### Step 6. トリガー（定期実行）の設定

手動テストが成功したら、定期的に自動実行されるようにトリガーを設定します。

1. GASエディタの **左側サイドバー** にある **時計アイコン（「トリガー」）** をクリックします。
   * または、URL直接アクセス: **https://script.google.com/home/triggers**
2. 画面右下の **「+ トリガーを追加」** ボタンをクリックします。
3. **トリガー設定ダイアログ** が表示されます。以下のように設定してください。

| 設定項目 | 選択する値 |
|---------|-----------|
| 実行する関数を選択 | **`autoSyncToNotebookLM`** |
| 実行するデプロイを選択 | **`Head`** |
| イベントのソースを選択 | **`時間主導型`** |
| 時間ベースのトリガーのタイプを選択 | **`分ベースのタイマー`** |
| 時間の間隔を選択（分） | **`1分おき`** または **`5分おき`** |

4. 右下の **「保存」** ボタンをクリックします。
5. トリガー一覧画面に、追加したトリガーが表示されていれば設定完了です。

---

### Step 7. NotebookLM にソースを追加

変換されたファイルを NotebookLM に読み込ませます。

1. ブラウザで **NotebookLM** を開きます。
   * URL: **https://notebooklm.google.com/**
2. **「+ 新しいノートブック」** をクリックして、新しいノートブックを作成します（既存のノートブックを使う場合はスキップ）。
3. ノートブック画面左側の **「ソース」** パネルにある **「+ ソースを追加」** をクリックします。
4. ソース選択画面で **「Google ドライブ」** をクリックします。
5. フォルダツリーから **`NoteBookLM`** フォルダ（Step 5 で自動生成されたもの）を開きます。
6. 読み込みたいファイルを選択し（`Ctrl + クリック` で複数選択可）、右下の **「挿入」** をクリックします。
7. ソースパネルにファイルが追加されたら完了です。

> **ファイル更新時の同期方法**: 元ファイルを更新すると、スクリプトがGoogleドキュメントの中身を自動書き換えします。NotebookLM側では、ソースパネルのファイル名横にある **「🔄」（同期アイコン）** をクリックすると最新の内容が反映されます。

## 👷 運用ルール（スタッフ向け）

* **ファイルの追加**: 新しい資料をAIに読み込ませたい場合は、監視対象フォルダ（親フォルダ）にそのまま `.pdf` や `.md` をドロップしてください。数分後に自動処理されます。
* **ファイルの更新**: 既存の資料を更新したい場合は、**「同じファイル名」**で親フォルダに再度ドロップしてください。システムが自動で検知し、NotebookLM側のデータを上書き更新します。
* **確認方法**: `NoteBookLM` フォルダ内の「同期ログ」ドキュメントを開くと、最新の取り込み状況を確認できます。

## ⚠️ 注意事項・制限
* **OCRの精度**: PDFのテキスト化はGoogle Driveの標準OCRに依存します。画像化されたテキストの解像度が低い場合、AIが正確に読み取れないことがあります。
* **手動実行**: 即座に反映させたい場合は、GASのエディタ画面から `autoSyncToNotebookLM` を手動で「実行」することも可能です。
